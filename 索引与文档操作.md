

# 实验二：**索引&文档操作**

> **学院：计算机科学与技术学院**
>
> **题目：**《 实验二：索引&文档操作》
>
> **姓名：满家荣**
>
> **学号：**220070216
>
> **班级：**软工2205
>
> **日期：**2024-09-14
>
> **实验环境：** Elasticsearch，postman

## 一、实验目的 

> 1. 掌握Elasticsearch 安装IK分词器安装方法
> 2. 掌握Elasticsearch 索引操作方法
> 3. 掌握Elasticsearch 文档操作训练
> 4. Elasticsearch 高级查询与DSL训练

## 二、实验内容 

> 1. Elasticsearch 安装IK分词器
> 2. Elasticsearch 索引操作训练
> 3. Elasticsearch 文档操作训练
> 4. Elasticsearch 高级查询与DSL训练

## 三、问题及解决办法

 

### 1.索引操作练习

   **1.1创建索引**

​	 建立`user infomation`索引

![](/first_index.png)

​	 建立`product catalog`索引

![](/second_index.png)

​	 建立`order records`索引

![](/third_index.png)

####    1.2修改索引(自己设计，修改要合理）

​	 索引创建后不能直接修改原有参数，只可用`_mapping`添加新字段

![](/change_index.png)

####    1.3删除索引

​	 删除`user_information`索引

![](/delete_index.png)

####    1.4查看所有

​	 查看刚刚创建的所有索引

![](/search_index.png)



---



### 2.文档操作练习

####   2.1创建文档

​	使用`POST`请求创建一个新用户文档

![](/create_file1.png)

####   2.2修改文档(自己设计，修改要合理）

​	 使用`_update`请求修改文档，修改`name`字段：

![](/update_file1.png)

####   2.3删除文档

​	 删除刚刚创建的id为`001`的文档

![](/delete_file1.png)

####   2.4查看文档

​	 查看刚刚创建的id为`001`的文档

![](/get_file1.png)

####   2.5将下面的Json数据批量导入ES数据库中

​	 使用`_bulk`将数据批量导入`user_information`

![](/create_file2.png)

​	 使用`_bulk`将数据批量导入`product_catalog`

![](/create_file3.png)

​	 使用`_bulk`将数据批量导入`order_records`

![](/create_file4.png)

---



### 3.高级查询&DSL练习

​	 *完成下面的30道练习题*

> **1.查询所有女性用户的姓名和电子邮件。**

~~~json
GET http://localhost:9200/user_information/_search

// select name,email from user_information where gender="female"
{
  "_source": ["name", "email"],
  "query": {
    "term": { "gender": "female" }
  }
}
~~~

​	**查询结果：**

~~~json
{
    "took": 21,
    "timed_out": false,
    "_shards": {
        "total": 1,
        "successful": 1,
        "skipped": 0,
        "failed": 0
    },
    "hits": {
        "total": {
            "value": 10,
            "relation": "eq"
        },
        "max_score": 0.78411895,
        "hits": [
            {
                "_index": "user_information",
                "_id": "001",
                "_score": 0.78411895,
                "_source": {
                    "name": "Alice Johnson",
                    "email": "alice.johnson@example.com"
                }
            },
            {
                "_index": "user_information",
                "_id": "005",
                "_score": 0.78411895,
                "_source": {
                    "name": "Eve Davis",
                    "email": "eve.davis@example.com"
                }
            },
            {
                "_index": "user_information",
                "_id": "007",
                "_score": 0.78411895,
                "_source": {
                    "name": "Grace Lee",
                    "email": "grace.lee@example.com"
                }
            },
            {
                "_index": "user_information",
                "_id": "008",
                "_score": 0.78411895,
                "_source": {
                    "name": "Hannah White",
                    "email": "hannah.white@example.com"
                }
            },
            {
                "_index": "user_information",
                "_id": "009",
                "_score": 0.78411895,
                "_source": {
                    "name": "Ivy Green",
                    "email": "ivy.green@example.com"
                }
            },
            {
                "_index": "user_information",
                "_id": "011",
                "_score": 0.78411895,
                "_source": {
                    "name": "Karen Adams",
                    "email": "karen.adams@example.com"
                }
            },
            {
                "_index": "user_information",
                "_id": "013",
                "_score": 0.78411895,
                "_source": {
                    "name": "Mia Moore",
                    "email": "mia.moore@example.com"
                }
            },
            {
                "_index": "user_information",
                "_id": "014",
                "_score": 0.78411895,
                "_source": {
                    "name": "Nina Scott",
                    "email": "nina.scott@example.com"
                }
            },
            {
                "_index": "user_information",
                "_id": "018",
                "_score": 0.78411895,
                "_source": {
                    "name": "Rose Hall",
                    "email": "rose.hall@example.com"
                }
            },
            {
                "_index": "user_information",
                "_id": "020",
                "_score": 0.78411895,
                "_source": {
                    "name": "Tina Brown",
                    "email": "tina.brown@example.com"
                }
            }
        ]
    }
}
~~~



> **2.查找最后登录日期在2024年9月1日之后的所有活跃用户。**

~~~json
GET http://localhost:9200/user_information/_search
{
  "query": {
    "bool": {
      "must": [
        { "term": { "status": "active" } },
        { "range": { "last_login": { "gt": "2024-09-01" } } }
      ]
    }
  }
}
~~~

~~~json
{
    "took": 14,
    "timed_out": false,
    "_shards": {
        "total": 1,
        "successful": 1,
        "skipped": 0,
        "failed": 0
    },
    "hits": {
        "total": {
            "value": 11,
            "relation": "eq"
        },
        "max_score": 1.3946542,
        "hits": [
            {
                "_index": "user_information",
                "_id": "005",
                "_score": 1.3946542,
                "_source": {
                    "user_id": "005",
                    "name": "Eve Davis",
                    "email": "eve.davis@example.com",
                    "date_of_birth": "1995-07-22",
                    "gender": "female",
                    "address": "202 Pine St, Otherville, USA",
                    "phone_number": "567-890-1234",
                    "registration_date": "2023-05-18",
                    "last_login": "2024-09-02",
                    "status": "active"
                }
            },
            {
                "_index": "user_information",
                "_id": "006",
                "_score": 1.3946542,
                "_source": {
                    "user_id": "006",
                    "name": "Frank Miller",
                    "email": "frank.miller@example.com",
                    "date_of_birth": "1991-10-05",
                    "gender": "male",
                    "address": "303 Cedar Rd, Newtown, USA",
                    "phone_number": "678-901-2345",
                    "registration_date": "2023-06-22",
                    "last_login": "2024-09-03",
                    "status": "active"
                }
            },
            {
                "_index": "user_information",
                "_id": "008",
                "_score": 1.3946542,
                "_source": {
                    "user_id": "008",
                    "name": "Hannah White",
                    "email": "hannah.white@example.com",
                    "date_of_birth": "1993-12-25",
                    "gender": "female",
                    "address": "505 Spruce St, Littletown, USA",
                    "phone_number": "890-123-4567",
                    "registration_date": "2023-08-15",
                    "last_login": "2024-09-06",
                    "status": "active"
                }
            },
            {
                "_index": "user_information",
                "_id": "009",
                "_score": 1.3946542,
                "_source": {
                    "user_id": "009",
                    "name": "Ivy Green",
                    "email": "ivy.green@example.com",
                    "date_of_birth": "1994-03-03",
                    "gender": "female",
                    "address": "606 Willow Ave, Bigcity, USA",
                    "phone_number": "901-234-5678",
                    "registration_date": "2023-09-01",
                    "last_login": "2024-09-07",
                    "status": "active"
                }
            },
            {
                "_index": "user_information",
                "_id": "011",
                "_score": 1.3946542,
                "_source": {
                    "user_id": "011",
                    "name": "Karen Adams",
                    "email": "karen.adams@example.com",
                    "date_of_birth": "1990-09-21",
                    "gender": "female",
                    "address": "808 Chestnut Blvd, Metropolis, USA",
                    "phone_number": "123-456-7890",
                    "registration_date": "2023-11-25",
                    "last_login": "2024-09-09",
                    "status": "active"
                }
            },
            {
                "_index": "user_information",
                "_id": "012",
                "_score": 1.3946542,
                "_source": {
                    "user_id": "012",
                    "name": "Leo King",
                    "email": "leo.king@example.com",
                    "date_of_birth": "1986-01-12",
                    "gender": "male",
                    "address": "909 Ash Ct, Villagetown, USA",
                    "phone_number": "234-567-8901",
                    "registration_date": "2023-12-05",
                    "last_login": "2024-09-10",
                    "status": "active"
                }
            },
            {
                "_index": "user_information",
                "_id": "014",
                "_score": 1.3946542,
                "_source": {
                    "user_id": "014",
                    "name": "Nina Scott",
                    "email": "nina.scott@example.com",
                    "date_of_birth": "1988-05-05",
                    "gender": "female",
                    "address": "1111 Cypress St, Township, USA",
                    "phone_number": "456-789-0123",
                    "registration_date": "2024-02-14",
                    "last_login": "2024-09-12",
                    "status": "active"
                }
            },
            {
                "_index": "user_information",
                "_id": "015",
                "_score": 1.3946542,
                "_source": {
                    "user_id": "015",
                    "name": "Oscar Turner",
                    "email": "oscar.turner@example.com",
                    "date_of_birth": "1991-07-19",
                    "gender": "male",
                    "address": "1212 Redwood Rd, Cityville, USA",
                    "phone_number": "567-890-1234",
                    "registration_date": "2024-03-20",
                    "last_login": "2024-09-13",
                    "status": "active"
                }
            },
            {
                "_index": "user_information",
                "_id": "017",
                "_score": 1.3946542,
                "_source": {
                    "user_id": "017",
                    "name": "Quinn Hughes",
                    "email": "quinn.hughes@example.com",
                    "date_of_birth": "1993-11-11",
                    "gender": "male",
                    "address": "1414 Beech St, Suburbia, USA",
                    "phone_number": "789-012-3456",
                    "registration_date": "2024-05-30",
                    "last_login": "2024-09-15",
                    "status": "active"
                }
            },
            {
                "_index": "user_information",
                "_id": "018",
                "_score": 1.3946542,
                "_source": {
                    "user_id": "018",
                    "name": "Rose Hall",
                    "email": "rose.hall@example.com",
                    "date_of_birth": "1990-03-22",
                    "gender": "female",
                    "address": "1515 Palm Dr, Downtown, USA",
                    "phone_number": "890-123-4567",
                    "registration_date": "2024-06-15",
                    "last_login": "2024-09-16",
                    "status": "active"
                }
            }
        ]
    }
}
~~~

